---
title: "Diversity"
bibliography: 
- bibliography.bib
- references.bib
output: 
  prettydoc::html_pretty:
    theme: cayman
    highlight: github
---
<!--
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteIndexEntry{microbiome tutorial - diversity}
  %\usepackage[utf8]{inputenc}
  %\VignetteEncoding{UTF-8}  
-->


## Alpha richness and diversity

See a separate page on [Beta diversity](Betadiversity.html).

Load example data:

```{r divdata, warning=FALSE, message=FALSE, fig.height=3, fig.width=5}
library(microbiome)
data(atlas1006)
pseq <- atlas1006
```


### Diversity estimation

Estimate diversity (table with various diversity measures):

```{r divest, warning=FALSE, message=FALSE, fig.height=3, fig.width=5}
diversity <- microbiome::global(pseq, detection = 0)
head(kable(diversity))
```

The supported divesity measures include those supported in the phyloseq::estimate_richness, with some additional utilities. In addition, further measures are provided, including: (Pielou's) Evenness; Dominance (relative proportion of the most dominant species); Rarity (relative proportion of the rare taxa ie those not in the core); 


### Top abundance

Top abundance index refers to the abundance of the most dominant species. The rank parameter can be used to calculate the sum of abundances of the top-n taxa instead of the single most abundant one. 


```{r divest, warning=FALSE, message=FALSE}
# Absolute abundances
ta <- top_abundance(pseq)

# Relative abundances
ta <- top_abundance(transform(pseq, "compositional"))
```


### Dominance


```{r divest, warning=FALSE, message=FALSE}
# Absolute abundances
do <- dominance(pseq)

# Relative abundances
do <- dominance(transform(pseq, "compositional"))
```


### Rarity

Rarity index refers to the relative proportion of the rare species (those that are not among the core members). It can be returned by the generic diversity function, or calculated directly. See also the core_abundance function, which provides the complement.

```{r divest, warning=FALSE, message=FALSE}
ra <- rarity(pseq)
```



### Gini index

Gini index is a common measure for inequality in economical income, but can also be used
as a community diversity measure.

```{r divest, warning=FALSE, message=FALSE}
gi <- microbiome::gini(pseq)
```




### Visualization

Show diversity:

```{r div-example2, warning=FALSE, message=FALSE, fig.width=8, fig.height=4}
library(ggplot2)
theme_set(theme_bw(20)) # Set bw color scheme
p <- ggplot(diversity, aes(x = Shannon)) + geom_histogram()
print(p)
```

Visualize diversity measures w.r.t. discrete variable (or check more generic [group-wise comparison tools](Comparisons.html))

```{r div-example2bb, warning=FALSE, message=FALSE, fig.width=8, fig.height=4}
p <- plot_diversity(pseq, "bmi_group", measures = c("Chao1", "Shannon"), indicate.subjects = FALSE)
print(p)
```

### Group-wise comparison

To indicate time as discrete variable, order it as a factor. If a
subject column is available in sample data the subjects will be
indicated by lines across the groups

```{r div-groupwise, warning=FALSE, message=FALSE, fig.width=8, fig.height=4}
# Visualize diversities across groups
p <- plot_diversity(pseq, "gender", measures = c("Chao1", "Shannon"), indicate.subject = TRUE)
print(p)
```


Diversity vs. continuous variable:

```{r diversity-example13, fig.width=8, fig.height=5, message=FALSE, warning=FALSE, dev="CairoPNG"}
library(dplyr)
pseq <- atlas1006

# Add diversity into sample metadata
sample_data(pseq)$diversity <- microbiome::global(pseq)$Shannon

# Visualize
p <- plot_regression(diversity ~ age, meta(pseq))
print(p)
```


