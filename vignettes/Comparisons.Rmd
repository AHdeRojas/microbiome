
## Group-wise comparisons

Read example data from a [diet swap study](http://dx.doi.org/10.1038/ncomms7342):

```{r comparisons-example, warning=FALSE, message=FALSE}
library(microbiome)
data("dietswap")
pseq <- dietswap
```

### Comparing of two or more groups with a parametric test (linear model; ANOVA)

Note that in practice it will be necessary to check ANOVA modeling assumptions before testing:

```{r comparisons2}
# Convert to relative abundances
pseq <- transform_phyloseq(pseq, "relative.abundance")

# 1-way ANOVA p-values for the multi-group comparison across time groups
anova.results <- check_anova(pseq, "group", p.adjust.method = "BH")
kable(head(anova.results))
```


### Wilcoxon test (two-group comparisons)

If the data remarkably violates Gaussian assumptions use
non-parametric test. Wilcoxon is one option for two group
comparison. Here we compare males and females in the example data.

```{r comparisons-exampless}
pval <- check_wilcoxon(pseq, "sex")
```


### Comparison with random effect subject term

```{r comparisons-lmer, eval=FALSE}
pseq <- peerj32$phyloseq

# We need taxa x samples matrix
mydata <- otu_table(x)@.Data
if (!taxa_are_rows(x)) {mydata <- t(mydata)}

tax <- "Dialister"
dfs <- sample_data(x)
dfs$signal <- mydata[tax, rownames(dfs)]
dfs$group <- dfs[[group]]

# Paired comparison
library(lme4)
out <- lmer(signal ~ group + (1|subject), data = dfs)
out0 <- lmer(signal ~ (1|subject), data = dfs)
comp <- anova(out0, out)
pv <- comp[["Pr(>Chisq)"]][[2]]
```


