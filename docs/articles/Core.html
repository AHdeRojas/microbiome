<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Core microbiome â€¢ microbiome</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">microbiome</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Core microbiome</h1>
            
          </div>

    
    
<div class="contents">
<!--
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteIndexEntry{microbiome tutorial - core}
  %\usepackage[utf8]{inputenc}
  %\VignetteEncoding{UTF-8}  
-->
<div id="core-microbiota-analysis" class="section level2">
<h2 class="hasAnchor">
<html><body><a href="#core-microbiota-analysis" class="anchor"> </a></body></html>Core microbiota analysis</h2>
<p>See also related functions for the analysis of rare taxa.</p>
<p>Load example data:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Load data</span>
<span class="kw">library</span>(microbiome)
<span class="kw">data</span>(peerj32)

<span class="co"># Rename the data</span>
pseq &lt;-<span class="st"> </span>peerj32$phyloseq

<span class="co"># Calculate compositional version of the data</span>
<span class="co"># (relative abundances)</span>
pseq.rel &lt;-<span class="st"> </span><span class="kw"><a href="../reference/transform.html">transform</a></span>(pseq, <span class="st">"compositional"</span>)</code></pre></div>
<div id="prevalence-of-taxonomic-groups" class="section level3">
<h3 class="hasAnchor">
<html><body><a href="#prevalence-of-taxonomic-groups" class="anchor"> </a></body></html>Prevalence of taxonomic groups</h3>
<p>Relative population frequencies; at 1% compositional abundance threshold:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(<span class="kw"><a href="../reference/prevalence.html">prevalence</a></span>(pseq.rel, <span class="dt">detection =</span> <span class="dv">1</span>, <span class="dt">sort =</span> <span class="ot">TRUE</span>))</code></pre></div>
<pre><code>##  Yersinia et rel.  Xanthomonadaceae  Wissella et rel.            Vibrio 
##                 0                 0                 0                 0 
## Weissella et rel.       Veillonella 
##                 0                 0</code></pre>
<p>Absolute population frequencies (sample count):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(<span class="kw"><a href="../reference/prevalence.html">prevalence</a></span>(pseq.rel, <span class="dt">detection =</span> <span class="dv">1</span>, <span class="dt">sort =</span> <span class="ot">TRUE</span>, <span class="dt">count =</span> <span class="ot">TRUE</span>))</code></pre></div>
<pre><code>##  Yersinia et rel.  Xanthomonadaceae  Wissella et rel.            Vibrio 
##                 0                 0                 0                 0 
## Weissella et rel.       Veillonella 
##                 0                 0</code></pre>
</div>
<div id="core-microbiota-analysis-1" class="section level3">
<h3 class="hasAnchor">
<html><body><a href="#core-microbiota-analysis-1" class="anchor"> </a></body></html>Core microbiota analysis</h3>
<p>If you only need the names of the core taxa, do as follows. The standard method corresponds to taxa that exceed the given prevalence and detection thresholds. The bootstrap method is slower but more robust (<a href="http://onlinelibrary.wiley.com/doi/10.1111/j.1469-0691.2012.03855.x/abstract">Salonen et al. CMI (2012)</a>); it reduces random sampling effects.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Standard method (based on simple detection and prevalence thresholding)</span>
core.taxa.standard &lt;-<span class="st"> </span><span class="kw"><a href="../reference/core_members.html">core_members</a></span>(pseq.rel, <span class="dt">detection =</span> <span class="dv">5</span>, <span class="dt">prevalence =</span> <span class="dv">50</span>,  <span class="dt">method =</span> <span class="st">"standard"</span>)

<span class="co"># Bootrap method: slower but more robust; takes sampling effects into account</span>
core.taxa.bootstrap &lt;-<span class="st"> </span><span class="kw"><a href="../reference/core_members.html">core_members</a></span>(pseq.rel, <span class="dt">detection =</span> <span class="dv">5</span>, <span class="dt">prevalence =</span> <span class="dv">50</span>,  <span class="dt">method =</span> <span class="st">"bootstrap"</span>, <span class="dt">bs.iter =</span> <span class="dv">50</span>)</code></pre></div>
<p>A full phyloseq object of the core microbiota is obtained as follows:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pseq.core &lt;-<span class="st"> </span><span class="kw"><a href="../reference/core.html">core</a></span>(pseq.rel, <span class="dt">detection =</span> <span class="dv">0</span>, <span class="dt">prevalence =</span> .<span class="dv">5</span>)
pseq.core.bootstrap &lt;-<span class="st"> </span><span class="kw"><a href="../reference/core.html">core</a></span>(pseq.rel, <span class="dt">detection =</span> <span class="dv">0</span>, <span class="dt">prevalence =</span> .<span class="dv">5</span>, <span class="dt">method =</span> <span class="st">"bootstrap"</span>, <span class="dt">bs.iter =</span> <span class="dv">50</span>)</code></pre></div>
<p>Retrieving the associated taxa names from the phyloseq object:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">core.taxa &lt;-<span class="st"> </span><span class="kw"><a href="../reference/taxa.html">taxa</a></span>(pseq.core)</code></pre></div>
</div>
<div id="core-abundance-and-diversity" class="section level3">
<h3 class="hasAnchor">
<html><body><a href="#core-abundance-and-diversity" class="anchor"> </a></body></html>Core abundance and diversity</h3>
<p>Total core abundance in each sample (sum of abundances of the core members):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">core.abundance &lt;-<span class="st"> </span><span class="kw">sample_sums</span>(<span class="kw"><a href="../reference/core.html">core</a></span>(pseq.rel, <span class="dt">detection =</span> .<span class="dv">01</span>, <span class="dt">prevalence =</span> .<span class="dv">95</span>))</code></pre></div>
</div>
</div>
<div id="core-visualization" class="section level2">
<h2 class="hasAnchor">
<html><body><a href="#core-visualization" class="anchor"> </a></body></html>Core visualization</h2>
<div id="core-line-plots" class="section level3">
<h3 class="hasAnchor">
<html><body><a href="#core-line-plots" class="anchor"> </a></body></html>Core line plots</h3>
<p>Determine core microbiota across various abundance/prevalence thresholds with the blanket analysis <a href="http://onlinelibrary.wiley.com/doi/10.1111/j.1469-0691.2012.03855.x/abstract">(Salonen et al. CMI, 2012)</a> based on various signal and prevalences.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># With absolute read counts</span>
det &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">50</span>, <span class="dv">100</span>, <span class="dv">200</span>, <span class="dv">500</span>, <span class="dv">1000</span>, <span class="dv">2000</span>)
prevalences &lt;-<span class="st"> </span><span class="kw">seq</span>(.<span class="dv">05</span>, <span class="dv">1</span>, .<span class="dv">05</span>)
p &lt;-<span class="st"> </span><span class="kw"><a href="../reference/plot_core.html">plot_core</a></span>(pseq, <span class="dt">prevalences =</span> prevalences, <span class="dt">detections =</span> det, <span class="dt">plot.type =</span> <span class="st">"lineplot"</span>)
p +<span class="st"> </span><span class="kw">xlab</span>(<span class="st">"Abundance (OTU read count)"</span>)

<span class="co"># With compositional (relative) abundances</span>
det &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">0.1</span>, <span class="fl">0.2</span>, <span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">20</span>)/<span class="dv">100</span>
p &lt;-<span class="st"> </span><span class="kw"><a href="../reference/plot_core.html">plot_core</a></span>(pseq.rel, <span class="dt">prevalences =</span> prevalences, <span class="dt">detections =</span> det, <span class="dt">plot.type =</span> <span class="st">"lineplot"</span>)
p +<span class="st"> </span><span class="kw">xlab</span>(<span class="st">"Relative Abundance (%)"</span>)</code></pre></div>
<p><img src="Core_files/figure-html/core-example2-1.png" width="400px"><img src="Core_files/figure-html/core-example2-2.png" width="400px"></p>
</div>
<div id="core-heatmaps" class="section level3">
<h3 class="hasAnchor">
<html><body><a href="#core-heatmaps" class="anchor"> </a></body></html>Core heatmaps</h3>
<p>This visualization method has been used for instance in <a href="https://academic.oup.com/femsre/article/doi/10.1093/femsre/fuw045/2979411/Intestinal-microbiome-landscaping-insight-in#58802539">Intestinal microbiome landscaping: Insight in community assemblage and implications for microbial modulation strategies</a>. Shetty et al. <em>FEMS Microbiology Reviews</em> fuw045, 2017.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Core with compositionals:</span>
prevalences &lt;-<span class="st"> </span><span class="kw">seq</span>(.<span class="dv">05</span>, <span class="dv">1</span>, .<span class="dv">05</span>)
detections &lt;-<span class="st"> </span><span class="dv">10</span>^<span class="kw">seq</span>(<span class="kw">log10</span>(<span class="fl">1e-3</span>), <span class="kw">log10</span>(.<span class="dv">2</span>), <span class="dt">length =</span> <span class="dv">20</span>)

<span class="co"># Also define gray color palette</span>
gray &lt;-<span class="st"> </span><span class="kw">gray</span>(<span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dt">length=</span><span class="dv">5</span>))
p &lt;-<span class="st"> </span><span class="kw"><a href="../reference/plot_core.html">plot_core</a></span>(pseq.rel, <span class="dt">plot.type =</span> <span class="st">"heatmap"</span>, <span class="dt">colours =</span> gray,
    <span class="dt">prevalences =</span> prevalences, <span class="dt">detections =</span> detections) +
<span class="st">    </span><span class="kw">xlab</span>(<span class="st">"Detection Threshold (Relative Abundance (%))"</span>)
<span class="kw">print</span>(p)    


<span class="co"># Same with the viridis color palette</span>
<span class="co"># color-blind friendly and uniform</span>
<span class="co"># options: viridis, magma, plasma, inferno</span>
<span class="co"># https://cran.r-project.org/web/packages/viridis/vignettes/intro-to-viridis.html</span>
<span class="co"># Also discrete=TRUE versions available</span>
<span class="kw">library</span>(viridis)
<span class="kw">print</span>(p +<span class="st"> </span><span class="kw">scale_fill_viridis</span>())</code></pre></div>
<pre><code>## Scale for 'fill' is already present. Adding another scale for 'fill',
## which will replace the existing scale.</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Core with absolute counts and horizontal view:</span>
<span class="co"># and minimum population prevalence (given as percentage)</span>
detections &lt;-<span class="st"> </span><span class="dv">10</span>^<span class="kw">seq</span>(<span class="kw">log10</span>(<span class="dv">1</span>), <span class="kw">log10</span>(<span class="kw">max</span>(<span class="kw"><a href="../reference/abundances.html">abundances</a></span>(pseq))/<span class="dv">10</span>), <span class="dt">length =</span> <span class="dv">20</span>)

<span class="kw">library</span>(RColorBrewer)
p &lt;-<span class="st"> </span><span class="kw"><a href="../reference/plot_core.html">plot_core</a></span>(pseq, <span class="dt">plot.type =</span> <span class="st">"heatmap"</span>, 
             <span class="dt">prevalences =</span> prevalences,
             <span class="dt">detections =</span> detections,
         <span class="dt">colours =</span> <span class="kw">rev</span>(<span class="kw">brewer.pal</span>(<span class="dv">5</span>, <span class="st">"Spectral"</span>)),
         <span class="dt">min.prevalence =</span> .<span class="dv">2</span>, <span class="dt">horizontal =</span> <span class="ot">TRUE</span>)
<span class="kw">print</span>(p)</code></pre></div>
<p><img src="Core_files/figure-html/core-example3-1.png" width="200px"><img src="Core_files/figure-html/core-example3-2.png" width="200px"><img src="Core_files/figure-html/core-example3-3.png" width="200px"></p>
<div id="refs" class="references">

</div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#core-microbiota-analysis">Core microbiota analysis</a></li>
      <li><a href="#core-visualization">Core visualization</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Leo Lahti.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
