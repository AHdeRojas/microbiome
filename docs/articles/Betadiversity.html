<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Beta diversity and microbiome divergence â€¢ microbiome</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">microbiome</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Beta diversity and microbiome divergence</h1>
            
          </div>

    
    
<div class="contents">
<!--
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteIndexEntry{microbiome tutorial - variability}
  %\usepackage[utf8]{inputenc}
  %\VignetteEncoding{UTF-8}  
-->
<div id="beta-diversity" class="section level2">
<h2 class="hasAnchor">
<html><body><a href="#beta-diversity" class="anchor"> </a></body></html>Beta diversity</h2>
<p>Some examples on calculating beta diversity and using it to quantify community divergence within a given sample set.</p>
<p>Load example data</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(microbiome)
<span class="kw">data</span>(peerj32)
pseq &lt;-<span class="st"> </span>peerj32$phyloseq</code></pre></div>
<div id="quantifying-group-divergence-spread" class="section level3">
<h3 class="hasAnchor">
<html><body><a href="#quantifying-group-divergence-spread" class="anchor"> </a></body></html>Quantifying group divergence / spread</h3>
<p>Divergence of a given sample set can be quantified as the average dissimilarity of each sample from the group mean; the dissimilarity can be quantified by beta diversity, for instance. This was applied in group-level comparisons for instance in <a href="http://www.nature.com/ismej/journal/v8/n11/full/ismej201463a.html">Salonen et al. ISME J 2014</a> (they focused on homogeneity using inverse correlation, whereas here we focus on divergence using correlation but the measure is essentially the same).</p>
<p>Calculate group divergences within the LGG (probiotic) and Placebo groups</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">b.pla &lt;-<span class="st"> </span><span class="kw"><a href="../reference/group_divergence.html">group_divergence</a></span>(<span class="kw">subset_samples</span>(pseq, group ==<span class="st"> "Placebo"</span>))
b.lgg &lt;-<span class="st"> </span><span class="kw"><a href="../reference/group_divergence.html">group_divergence</a></span>(<span class="kw">subset_samples</span>(pseq, group ==<span class="st"> "LGG"</span>))</code></pre></div>
<p>Use these to compare microbiota divergence within each group. The LGG group tends to have smaller values, indicating that the samples are more similar to the group mean, and the LGG group is less heterogeneous (has smaller spread / is more homogeneous):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">boxplot</span>(<span class="kw">list</span>(<span class="dt">LGG =</span> b.lgg, <span class="dt">Placebo =</span> b.pla))</code></pre></div>
<p><img src="Betadiversity_files/figure-html/divergence-example2bbb-1.png" width="300px"></p>
<p>The <strong>inter- and intra-invididual stability</strong> (or homogeneity) measures are obtained as 1-b where b is the group divergence with the anticorrelation method (<a href="http://www.nature.com/ismej/journal/v8/n11/full/ismej201463a.html">Salonen et al. ISME J 2014</a>).</p>
</div>
<div id="intra-individual-divergence" class="section level3">
<h3 class="hasAnchor">
<html><body><a href="#intra-individual-divergence" class="anchor"> </a></body></html>Intra-individual divergence</h3>
<p>Quantify beta diversity within subjects over time (as in <a href="http://www.nature.com/ismej/journal/v8/n11/full/ismej201463a.html">Salonen et al. ISME J 2014</a> for intra-individual stability)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">betas &lt;-<span class="st"> </span><span class="kw">list</span>()
groups &lt;-<span class="st"> </span><span class="kw">as.character</span>(<span class="kw">unique</span>(<span class="kw"><a href="../reference/meta.html">meta</a></span>(pseq)$group))
for (g in groups) {
  <span class="co">#df &lt;- meta(subset_samples(pseq, group == g))</span>
  df &lt;-<span class="st"> </span><span class="kw">subset</span>(<span class="kw"><a href="../reference/meta.html">meta</a></span>(pseq), group ==<span class="st"> </span>g)
  beta &lt;-<span class="st"> </span><span class="kw">c</span>()

  for (subj in df$subject) {
    <span class="co"># Pick the samples for this subject</span>
    dfs &lt;-<span class="st"> </span><span class="kw">subset</span>(df, subject ==<span class="st"> </span>subj)
    <span class="co"># Check that the subject has two time points</span>
    if (<span class="kw">nrow</span>(dfs) ==<span class="st"> </span><span class="dv">2</span>) {
      s &lt;-<span class="st"> </span><span class="kw">as.character</span>(dfs$sample)
      <span class="co"># Here with just two samples we can calculate the</span>
      <span class="co"># beta diversity directly</span>
      beta[[subj]] &lt;-<span class="st"> </span><span class="dv">1</span>-<span class="kw">cor</span>(<span class="kw"><a href="../reference/abundances.html">abundances</a></span>(pseq)[, s[[<span class="dv">1</span>]]],
                        <span class="kw"><a href="../reference/abundances.html">abundances</a></span>(pseq)[, s[[<span class="dv">2</span>]]],
                <span class="dt">method =</span> <span class="st">"spearman"</span>)
    }
  }
  betas[[g]] &lt;-<span class="st"> </span>beta
}

<span class="kw">boxplot</span>(betas)</code></pre></div>
<p><img src="Betadiversity_files/figure-html/homogeneity-example2c-1.png" width="300px"></p>
</div>
<div id="beta-diversity-within-individual-over-time" class="section level3">
<h3 class="hasAnchor">
<html><body><a href="#beta-diversity-within-individual-over-time" class="anchor"> </a></body></html>Beta diversity within individual over time</h3>
<p>Calculate change in beta diversity (community dissimilarity) over time within a single individual</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(atlas1006)
pseq &lt;-<span class="st"> </span>atlas1006

<span class="co"># Identify subject with the longest time series (most time points)</span>
s &lt;-<span class="st"> </span><span class="kw">names</span>(<span class="kw">which.max</span>(<span class="kw">sapply</span>(<span class="kw">split</span>(<span class="kw"><a href="../reference/meta.html">meta</a></span>(pseq)$time, <span class="kw"><a href="../reference/meta.html">meta</a></span>(pseq)$subject), function (x) {<span class="kw">length</span>(<span class="kw">unique</span>(x))})))

<span class="co"># Pick the metadata for this subject and sort the</span>
<span class="co"># samples by time</span>
<span class="kw">library</span>(dplyr)
df &lt;-<span class="st"> </span><span class="kw"><a href="../reference/meta.html">meta</a></span>(pseq) %&gt;%<span class="st"> </span><span class="kw">filter</span>(subject ==<span class="st"> </span>s) %&gt;%<span class="st"> </span><span class="kw">arrange</span>(time)

<span class="co"># Calculate the beta diversity between each time point and</span>
<span class="co"># the baseline (first) time point</span>
beta &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>) <span class="co"># Baseline similarity</span>
s0 &lt;-<span class="st"> </span><span class="kw">subset</span>(df, time ==<span class="st"> </span><span class="dv">0</span>)$sample
for (tp in df$time[-<span class="dv">1</span>]) {
  <span class="co"># Pick the samples for this subject</span>
  <span class="co"># If the same time point has more than one sample,</span>
  <span class="co"># pick one at random</span>
  st &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">subset</span>(df, time ==<span class="st"> </span>tp)$sample, <span class="dv">1</span>)
  a &lt;-<span class="st"> </span><span class="kw"><a href="../reference/abundances.html">abundances</a></span>(pseq)
  b &lt;-<span class="st"> </span><span class="dv">1</span> -<span class="st"> </span><span class="kw">cor</span>(a[, s0], a[, st], <span class="dt">method =</span> <span class="st">"spearman"</span>)
  beta &lt;-<span class="st"> </span><span class="kw">rbind</span>(beta, <span class="kw">c</span>(tp, b))
}
<span class="kw">colnames</span>(beta) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">"time"</span>, <span class="st">"beta"</span>)
beta &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(beta)

<span class="kw">library</span>(ggplot2)
p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(beta, <span class="kw">aes</span>(<span class="dt">x =</span> time, <span class="dt">y =</span> beta)) +
<span class="st">       </span><span class="kw">geom_point</span>() +<span class="st"> </span><span class="kw">geom_line</span>()
<span class="kw">print</span>(p)       </code></pre></div>
<p><img src="Betadiversity_files/figure-html/homogeneity-example2d-1.png" width="300px"></p>
<pre><code>## [1] "ade4"
## [1] "compositions"
## [1] "MASS"
## [1] "moments"
## [1] "scales"
## [1] "tgp"
## [1] "WGCNA"
## [1] "diptest"
## [1] "FD"
## [1] "gcookbook"
## [1] "GGally"
## [1] "ggnet"
## [1] "Hmisc"
## [1] "hrbrthemes"
## [1] "igraph"
## [1] "intergraph"
## [1] "limma"
## [1] "lme4"
## [1] "netresponse"
## [1] "network"
## [1] "RColorBrewer"
## [1] "sna"
## [1] "SpiecEasi"
## [1] "tidyverse"
## [1] "viridis"</code></pre>
<div id="refs" class="references">

</div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#beta-diversity">Beta diversity</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Leo Lahti.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
